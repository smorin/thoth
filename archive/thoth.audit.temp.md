# Thoth Plan v2.0 vs PRD v17.0 Audit Report

## Executive Summary

This audit compares the Thoth Implementation Plan v2.0 with the Product Requirements Document v17.0 to identify inconsistencies. Each inconsistency is assigned a unique ID with detailed analysis and resolution recommendations.

---

## Inconsistency INC-001: Combined Report Default Behavior

**Issue**: Conflicting requirements for combined report generation

**Plan Reference**: 
- Lines 182: `M6-08`: Implement --combined flag, without it should be individual files by default

**PRD Reference**:
- Lines 148-150: `F-20`: Generate combined report from multi-provider results by default
- Line 449: `combine_reports = true           # create combined report by default`

**Reason**: The plan states that combined reports should NOT be generated by default (requiring --combined flag), while the PRD explicitly states combined reports should be generated BY DEFAULT with --no-combined to skip.

**Resolution Options**:
1. Update plan to match PRD: Change M6-08 to implement --no-combined flag
2. Update PRD to match plan: Change F-20 to require --combined flag

**Recommendation**: Option 1 - Update the plan to match PRD. The PRD's approach is more user-friendly as most users want a synthesized view by default.

**Final Decision**: Update PRD to match plan: Change F-20 to require --combined flag

---

## Inconsistency INC-002: Default Mode Name

**Issue**: Inconsistent default mode references

**Plan Reference**:
- Line 118: `M4-03`: Add default mode selection (deep_research)
- Line 129: `M4T-01`: Verify default mode is "default" (not deep_research)

**PRD Reference**:
- Line 128: `F-01`: When no mode specified, use 'default' mode with no system prompt
- Line 441: `default_mode = "default"          # Used when no mode specified (no system prompt)`

**Reason**: The plan shows conflicting information - M4-03 mentions deep_research as default while M4T-01 correctly states it should be "default".

**Resolution Options**:
1. Update M4-03 description to reflect "default" mode
2. Add clarification that M4-03 was the original implementation later corrected

**Recommendation**: Option 1 - Update M4-03 to clearly state "default" mode to avoid confusion.

**Final Decision**: Update M4-03 to clearly state "default" mode to avoid confusion.

---

## Inconsistency INC-003: Quiet Mode Implementation

**Issue**: Missing quiet mode implementation

**Plan Reference**:
- Line 758: Missing Core Features lists "Quiet Mode (-q flag referenced but not implemented)"
- Line 213: M7T-02 marked as "Cannot test" due to "-q flag not implemented"

**PRD Reference**:
- Line 281: `--quiet | | flag | Minimal output during execution`
- Line 152: `F-29`: Minimal output during execution unless --verbose

**Reason**: The PRD specifies --quiet flag as a requirement, but the plan acknowledges it's not implemented.

**Resolution Options**:
1. Add milestone task to implement --quiet flag
2. Remove --quiet from PRD requirements

**Recommendation**: Option 1 - Add implementation task in Milestone 7 (Progress and UX) for quiet mode.

**Final Decision**: Add implementation task in Milestone 7 (Progress and UX) for quiet mode.

---

## Inconsistency INC-004: Mock Provider API Key Requirement

**Issue**: Unclear mock provider API key behavior

**Plan Reference**:
- Line 464: "Mock provider requires no configuration"
- Line 602: "Use mock provider for testing (no API key needed)"

**PRD Reference**:
- Line 70: "Mock provider | Test provider that returns static responses WITHOUT requiring API keys"
- Line 169: `F-32`: Mock provider must work without any API keys for testing

**Reason**: While both documents agree mock provider shouldn't require API keys, the implementation details suggest it accepts dummy API keys, which could be confusing.

**Resolution Options**:
1. Clarify that mock provider accepts but doesn't validate API keys
2. Update mock provider to truly work without any API key requirement

**Recommendation**: Option 1 - Add clarification that mock provider accepts any value as API key for testing purposes.

**Final Decision**: Add clarification that mock provider accepts any value as API key for testing purposes.

---

## Inconsistency INC-005: Provider Flags Short Form

**Issue**: Inconsistent short flag for provider option

**Plan Reference**:
- Line 279: Not explicitly mentioned in plan

**PRD Reference**:
- Line 279: `--provider | -P | TEXT | Use single provider: openai, perplexity, or mock`

**Reason**: The PRD specifies -P as short form for --provider, but this isn't documented in the implementation plan.

**Resolution Options**:
1. Add -P short flag to implementation plan
2. Remove -P from PRD if not implemented

**Recommendation**: Option 1 - Add task to implement -P short flag in appropriate milestone.

**Final Decision**: Add task to implement -P short flag in appropriate milestone.

---

## Inconsistency INC-006: Config File Location Flag

**Issue**: Missing --config flag implementation

**Plan Reference**:
- Line 554: `M18-01`: Implement --config flag (referenced but not implemented)
- Line 759: Listed as missing core feature

**PRD Reference**:
- Line 284: `--config | -c | PATH | Read config from this file or dir`

**Reason**: The PRD lists --config as a current option, but the plan indicates it's not yet implemented.

**Resolution Options**:
1. Move --config to future features in PRD
2. Prioritize implementation in plan

**Recommendation**: Option 2 - This is a basic feature that should be prioritized in Milestone 18.

**Final Decision**: This is a basic feature that should be prioritized in Milestone 18, update as appropriate.

---

## Inconsistency INC-007: Error Output Behavior

**Issue**: Confusion about error output destination

**Plan Reference**:
- Line 66: "Errors appear in stdout not stderr" marked as issue

**PRD Reference**:
- Line 170: `F-33`: All error messages must go to stderr, not stdout
- Line 655: Notes that Rich console outputs to stdout by design, which is correct

**Reason**: There's confusion about whether Rich console output to stdout is an error or correct behavior.

**Resolution Options**:
1. Clarify that Rich console UI to stdout is correct, only error messages should use stderr
2. Implement error message routing separate from Rich UI

**Recommendation**: Option 1 - Add clear documentation that Rich UI uses stdout correctly while error messages use stderr.

**Final Decision**: Add clear documentation that Rich UI uses stdout correctly while error messages use stderr.

---

## Inconsistency INC-008: Progress Bar Implementation

**Issue**: Limited progress information mentioned as gap

**Plan Reference**:
- Line 789: "Progress Bars - Limited progress information" listed as UX gap

**PRD Reference**:
- Line 144: `F-17`: Show clear progress during research execution
- Lines 357-366: Show detailed progress example with spinners and status

**Reason**: The plan suggests progress bars are limited, but PRD shows detailed progress requirements already specified.

**Resolution Options**:
1. Update plan to reflect that basic progress is implemented
2. Clarify what additional progress features are missing

**Recommendation**: Option 2 - Specify exactly what progress enhancements are needed beyond current implementation.

**Final Decision**: Replace progress bars with a spinner that shows the total time elapsed, time till the next check (if applicable), time till timeout (if applicable). In PRD and implementation plan.

---

## Inconsistency INC-009: Output Format Options

**Issue**: Limited output format support

**Plan Reference**:
- Line 791: "Output Formats - Only markdown, no JSON/CSV/HTML"

**PRD Reference**:
- Line 98: "PDF/HTML export functionality" listed as out of scope for v1.5
- Line 450: `format = "markdown"              # output format`

**Reason**: The plan lists missing output formats as a gap, but PRD explicitly puts these out of scope.

**Resolution Options**:
1. Remove from gaps section as it's intentionally out of scope
2. Move to future enhancements section

**Recommendation**: Option 2 - Move to future enhancements to align with PRD scope.

**Final Decision**: Remove PDF/HTML export functionality references and remove as a gap. 

---

## Inconsistency INC-010: Test Command Examples

**Issue**: Test examples use different patterns

**Plan Reference**:
- Various test plans use technical test IDs (M1T-01, M2T-01, etc.)

**PRD Reference**:
- Lines 490-491, 517-518: Examples use `thoth "test query" --provider mock`

**Reason**: The plan uses formal test IDs while PRD uses natural language examples.

**Resolution Options**:
1. Add natural language examples to plan test sections
2. Keep formal test IDs but add user-friendly descriptions

**Recommendation**: Option 2 - Maintain formal test structure but ensure descriptions match PRD examples.

**Final Decision**: Add IDs to the PRD and have them referenced in the formal tests. 